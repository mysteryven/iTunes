{"version":3,"sources":["js/search.js"],"names":["view","el","template","render","songs","$","html","empty","map","data","songName","name","artist","artists","album","li","id","append","init","$el","model","currentSong","getSongs","axios","get","then","response","result","getCurrentSong","songId","url","getCurrentCover","albumId","console","log","cover","picUrl","controller","bindEvents","on","e","preventDefault","val","currentTarget","attr","initCurrentSong","window","eventHub","emit"],"mappings":"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","file":"search.a3177960.map","sourceRoot":"../src","sourcesContent":["{\n    let view = {\n        el: '#searchPage',\n        template: `\n        <form>\n            <div>\n            <input type=\"text\" placeholder=\"搜索音乐, 歌手\" id=\"songName\">\n            </div>\n            <div>\n            <button type=\"submit\">\n                <svg class=\"icon search-icon\" aria-hidden=\"true\">\n                <use xlink:href=\"#icon-search\"></use>\n                </svg>\n            </button>\n            </div>\n        </form>\n        <ul class=\"playList\" id=\"playList\">\n            <li>\n                <div class=\"item\">\n                    <span></span>\n                    <span></span>\n                    <span></span>\n                </div>\n            </li>\n        </ul>\n        `,\n        render(songs) {\n            if (!songs) {\n                $(this.el).html(this.template)\n            } else {\n                $('#playList').empty()\n                songs.map((data) => {\n                    let songName = data.name\n                    let artist = data.artists[0].name || ''\n                    let album = data.album.name || ''\n                    let li = `\n                    <li id=\"${data.id}\"\n                        data-name=\"${songName}\"\n                        data-artist=\"${artist}\"\n                        data-albumId=\"${data.album.id}\">\n                        <div class=\"item\">\n                            <span class=\"hideOverflow\">${songName}</span>\n                            <span class=\"hideOverflow\">${artist}</span>\n                            <span class=\"hideOverflow\">${album}</span>\n                        </div>\n                    </li> \n                    `\n                $('#playList').append(li)\n                })\n            }\n        },\n        init() {\n            this.$el = $(this.el)\n        }\n    }\n\n    let model = {\n        data: {\n            songs: [],\n            currentSong: {}\n        },\n        getSongs(songName) {\n            return axios.get('/search?keywords=' + songName).then((response) => {\n                this.data.songs = response.data.result.songs\n                return this.data.songs\n            })\n        },\n        getCurrentSong(songId) {\n            if (songId) { \n                return axios.get('/song/url?id=' + songId).then((response) => {\n                        this.data.currentSong.url = response.data.data[0].url\n                    })\n            }\n        },\n        getCurrentCover(albumId) {\n            if (albumId) {\n                return axios.get('/album?id=' + albumId).then((response) => {\n                    console.log(response)\n                    this.data.currentSong.cover = response.data.album.picUrl\n                })\n            }\n        }\n    }\n\n    let controller = {\n        init(view, model) {\n            this.view = view\n            this.model = model\n            this.view.render()\n            this.view.init()\n            this.bindEvents()\n        },\n        bindEvents() {\n            this.view.$el.on('submit', 'form', (e) => {\n                e.preventDefault()\n                let songName = $('#songName').val()\n                this.model.getSongs(songName).then(() => {\n                    this.view.render(this.model.data.songs)\n                })\n            })\n\n            this.view.$el.on('click', 'ul#playList > li', (e) => {\n                let songId = $(e.currentTarget).attr('id')\n                this.initCurrentSong(e)\n                \n                this.model.getCurrentSong(songId)\n                    .then(() => {\n                        this.model.getCurrentCover(this.model.data.currentSong.albumId).then(() => {\n                            window.eventHub.emit('playSong', this.model.data.currentSong)\n                    })\n                })\n            })\n        },\n        initCurrentSong(e) {\n            this.model.data.currentSong.albumId = $(e.currentTarget).attr('data-albumid')\n            this.model.data.currentSong.name = $(e.currentTarget).attr('data-name')\n            this.model.data.currentSong.artist = $(e.currentTarget).attr('data-artist')\n        }\n\n    }\n\n    controller.init(view, model)\n}"]}